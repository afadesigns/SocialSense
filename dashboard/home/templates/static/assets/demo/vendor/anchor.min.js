/**
 * AnchorJS - v4.0.0 - 2017-06-02
 * https://github.com/bryanbraun/anchorjs
 * Copyright (c) 2017 Bryan Braun; Licensed MIT
 */
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        define([], factory);
    } else if (typeof module === 'object' && module.exports) {
        module.exports = factory();
    } else {
        root.AnchorJS = factory();
        root.anchors = new root.AnchorJS();
    }
}(this, function () {
    'use strict';

    function AnchorJS(options) {
        this.options = options || {};
        this.elements = [];
        this.init();
    }

    AnchorJS.prototype.init = function () {
        this.setupOptions();
        this.isTouchDevice = this.isTouchDevice();
    };

    AnchorJS.prototype.setupOptions = function () {
        var defaultOptions = {
            icon: 'î§‹',
            visible: 'hover',
            placement: 'right',
            class: '',
            truncate: 64
        };

        Object.keys(defaultOptions).forEach(function (key) {
            if (!this.options.hasOwnProperty(key)) {
                this.options[key] = defaultOptions[key];
            }
        }, this);
    };

    AnchorJS.prototype.isTouchDevice = function () {
        return 'ontouchstart' in window || window.DocumentTouch && document instanceof DocumentTouch;
    };

    AnchorJS.prototype.add = function (selector) {
        if (!selector) {
            selector = 'h2, h3, h4, h5, h6';
        }

        var elements = this.getElements(selector);

        if (elements.length === 0) {
            return this;
        }

        this.injectStyles();

        for (var i = 0; i < elements.length; i++) {
            if (this.hasAnchorJSLink(elements[i])) {
                continue;
            }

            var id = this.getId(elements[i]);

            if (!id) {
                continue;
            }

            var link = this.createLink(id);
            this.insertLink(elements[i], link);
        }

        this.elements = this.elements.concat(elements);
        return this;
    };

    AnchorJS.prototype.getElements = function (selector) {
        if (typeof selector === 'string') {
            return [].slice.call(document.querySelectorAll(selector));
        } else if (Array.isArray(selector) || selector instanceof NodeList) {
            return [].slice.call(selector);
        } else {
            throw new Error('The selector provided to AnchorJS was invalid.');
        }
    };

    AnchorJS.prototype.injectStyles = function () {
        if (!document.head.querySelector("style.anchorjs")) {
            var style = document.createElement('style');
            style.className = 'anchorjs';
            style.appendChild(document.createTextNode(''));

            var headStyles = document.head.querySelector('[rel="stylesheet"], style');
            headStyles ? document.head.insertBefore(style, headStyles) : document.head.appendChild(style);

            style.sheet.insertRule('.anchorjs-link { opacity: 0; text-decoration: none; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }', style.sheet.cssRules.length);
            style.sheet.insertRule('*:hover > .anchorjs-link, .anchorjs-link:focus  { opacity: 1; }', style.sheet.cssRules.length);
            style.sheet.insertRule('[data-anchorjs-icon]::after { content: attr(data-anchorjs-icon); }', style.sheet.cssRules.length);
            style.sheet.insertRule('@font-face { font-family: "anchorjs-icons"; src: url(data:n/a;base64,AAEAAAALAIAAAwAwT1MvMg8yG2cAAAE4AAAAYGNtYXDp3gC3AAABpAAAAExnYXNwAAAAEAAAA9wAAAAIZ2x5ZlQCcfwAAAH4AAABCGhlYWQHFvHyAAAAvAAAADZoaGVhBnACFwAAAPQAAAAkaG10eASAADEAAAGYAAAADGxvY2EACACEAAAB8AAAAAhtYXhwAAYAVwAAARgAAAAgbmFtZQGOH9cAAAMAAAAAunBvc3QAAwAAAAADvAAAACAAAQAAAAEAAHzE2p9fDzz1AAkEAAAAAADRecUWAAAAANQA6R8AAAAAAoACwAAAAAgAAgAAAAAAAAABAAADwP/AAAACgAAA/9MCrQABAAAAAAAAAAAAAAAAAAAAAwABAAAAAwBVAAIAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAMCQAGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAg//0DwP/AAEADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAAAAIAAAACgAAxAAAAAwAAAAMAAAAcAAEAAwAAABwAAwABAAAAHAAEADAAAAAIAAgAAgAAACDpy//9//8AAAAg6cv//f///+EWNwADAAEAAAAAAAAAAAAAAAAACACEAAEAAAAAAAAAAAAAAAAxAAACAAQARAKAAsAAKwBUAAABIiYnJjQ3NzY2MzIWFxYUBwcGIicmNDc3NjQnJiYjIgYHBwYUFxYUBwYGIwciJicmNDc3NjIXFhQHBwYUFxYWMzI2Nzc2NCcmNDc2MhcWFAcHBg
