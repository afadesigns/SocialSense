"use strict";

// Black Dashboard Pro - v1.1.1
// https://themes.getbootstrap.com/product/black-dashboard-pro-premium-bootstrap-4-admin/

const transparent = true;
const transparentDemo = true;
const fixedTop = false;

let navbar_initialized = false;
let backgroundOrange = false;
let sidebar_mini_active = false;
let toggle_initialized = false;

const $html = $("html");
const $body = $("body");
const $navbar_minimize_fixed = $(".navbar-minimize-fixed");
const $collapse = $(".collapse");
const $navbar = $(".navbar");
const $tagsinput = $(".tagsinput");
const $selectpicker = $(".selectpicker");
const $navbar_color = $('[color-on-scroll]');
const $full_screen_map = $(".full-screen-map");
const $datetimepicker = $(".datetimepicker");
const $datepicker = $(".datepicker");
const $timepicker = $(".timepicker");

let seq = 0;
const delays = 80;
let seq2 = 0;
const delays2 = 80;

// Returns a function, that, as long as it continues to be invoked, will not
// be triggered. The function will be called after it stops being called for
// N milliseconds. If `immediate` is passed, trigger the function on the
// leading edge, instead of the trailing.
const debounce = (func, wait, immediate) => {
  let timeout;
  return function () {
    const context = this;
    const args = arguments;
    clearTimeout(timeout);
    timeout = setTimeout(() => {
      timeout = null;
      if (!immediate) func.apply(context, args);
    }, wait);
    if (immediate && !timeout) func.apply(context, args);
  };
};

(function () {
  const isWindows = navigator.platform.indexOf("Win") > -1;

  if (isWindows) {
    // if we are on windows OS we activate the perfectScrollbar function
    if ($(".main-panel").length !== 0) {
      const ps = new PerfectScrollbar(".main-panel", {
        wheelSpeed: 2,
        wheelPropagation: true,
        minScrollbarLength: 20,
        suppressScrollX: true,
      });
    }

    if ($(".sidebar .sidebar-wrapper").length !== 0) {
      const ps1 = new PerfectScrollbar(".sidebar .sidebar-wrapper");
      $(".table-responsive").each(function () {
        const ps2 = new PerfectScrollbar($(this)[0]);
      });
    }

    $html.addClass("perfect-scrollbar-on");
  } else {
    $html.addClass("perfect-scrollbar-off");
  }
})();

$(document).ready(function () {
  let scroll_start = 0;
  const startchange = $(".row");
  const offset = startchange.offset();
  const scrollElement =
    navigator.platform.indexOf("Win") > -1 ? $(".ps") : $(window);

  scrollElement.scroll(function () {
    scroll_start = $(this).scrollTop();

    if (scroll_start > 50) {
      $navbar_minimize_fixed.css("opacity", "1");
    } else {
      $navbar_minimize_fixed.css("opacity", "0");
    }
  });

  // hide the siblings opened collapse
  $collapse.on("show.bs.collapse", function () {
    $(this).parent().siblings().children(".collapse").each(function () {
      $(this).collapse("hide");
    });
  });

  //  Activate the Tooltips
  $('[data-toggle="tooltip"], [rel="tooltip"]').tooltip();

  // Activate Popovers and set color for popovers
  $('[data-toggle="popover"]').each(function () {
    const color_class = $(this).data("color");
    $(this).popover({
      template: `<div class="popover popover-${color_class}" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>`,
    });
  });

  const tagClass = $tagsinput.data("color");

  if ($tagsinput.length !== 0) {
    $tagsinput.tagsinput();
  }

  $(".bootstrap-tagsinput")
    .find(".tag")
    .addClass(`badge-${tagClass}`);

  //    Activate bootstrap-select
  if ($selectpicker.length !== 0) {
    $selectpicker.selectpicker({
      iconBase: "tim-icons",
      tickIcon: "icon-check-2",
    });
  }

  //when you click the modal search button the navbar will not be collapsed
  $("#search-button").click(function () {
    $(this).closest(".navbar-collapse").removeClass("show");
    $navbar.addClass("navbar-transparent").removeClass("bg-white");
  });

  blackDashboard.initMinimizeSidebar();

  const scroll_distance = $navbar_color.attr("color-on-scroll") || 500;

  // Check if we have the class "navbar-color-on-scroll" then add the function to remove the class "navbar-transparent" so it will transform to a plain color.
  if ($navbar_color.length !== 0) {
    blackDashboard.checkScrollForTransparentNavbar();
    $(window).on("scroll", blackDashboard.checkScrollForTransparentNavbar);
  }

  if ($full_screen_map.length == 
